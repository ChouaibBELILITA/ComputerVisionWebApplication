<!DOCTYPE html>
<html>
    <head>
        <title>WebSocket demo</title>
        
    </head>
    <body>
        <canvas width=1000px; height=400px; id="tools_sketch" width="250" height="250" style="border:1px solid #000000;">
        Sorry, your browser doesn't support the &lt;canvas&gt; element.     
        </canvas>
        <img id="video_frames" src=""/>
        <script>
            var ws = new WebSocket("ws://127.0.0.1:5678/");

            function b64toBlob(dataURI) {
                

                var byteString = atob(dataURI.split(',')[0]);
                
                var ab = new ArrayBuffer(byteString.length);
                var ia = new Uint8Array(ab);

                for (var i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                return new Blob([ab], { type: 'image/jpeg' });
            }
            ws.onmessage = function (event) {

                var js = JSON.parse(atob(event.data.split(',')[0]));
                console.log(js['id'])
                data=b64toBlob(js['data']);

                var urlObject = URL.createObjectURL(data);
                
                var canvas = document.getElementById("tools_sketch");
                var ctx = canvas.getContext("2d");

                var image = new Image();
                image.onload = function() {
                ctx.drawImage(image, 0, 0, image.width,    image.height,     // source rectangle
                   0, 0, canvas.width, canvas.height); 
                };
            
                image.src = urlObject;
                

            };/*
                ws.onmessage = function(event) {
                    
                    var img=document.getElementById("video_frames");
                    var urlObject = URL.createObjectURL(event.data);
                    img.src = urlObject;
                    document.body.appendChild(img);
                }*/
            

        </script>

    </body>
</html>